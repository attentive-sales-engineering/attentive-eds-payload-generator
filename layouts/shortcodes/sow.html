<div class="p-2" id="{{ .Params.id }}">

  <!-- <h3>Hugo Params</h3>
  {{ range $elem_key, $elem_val := .Params }}
  <b>{{ $elem_key }}</b>: <code>{{ $elem_val }}</code><br />
  {{ end }}
  <pre>
  .Site => {{ .Site }}
  .Site.Title => {{ .Site.Title }}
  .Page => {{ .Page }}
  .Page.Title => {{ .Page.Title }}
  .Params.id => {{ .Params.id }}
  </pre> -->

  <h2><span class="" data-client-name>{Client Name}</span>&nbsp;&ndash;&nbsp;EDS&nbsp;<span class="param" data-api>{API}
    </span>&nbsp;API
  </h2>
  <p><span class="" data-date>{Date}</span></p>

  <h2>Background</h2>
  <p>This Statement of Work defines the client's request to submit <span class="param" data-api>{API}</span> API
    requests for users via CSV upload.
  </p>

  <h2>Purpose</h2>
  <p>This Statement of Work covers the allowable scope of the project. Any term not defined herein shall have the
    meaning set forth in the Attentive Master Subscription Agreement or the relevant Order Form.</p>

  <h2>Specification</h2>
  <ol>
    <li>Client will upload files to SFTP with the following path and filename:<br><span class="param" data-file-name-and-date>{fileNameAndDate}</span></li>
    <li id="date-format" class=""><span class="param" data-date-format>{[[dateFormat]]}</span> represents the date the
      file will be processed.</li>
    <li id="frequency" class="">Files will be processed <span class="param" data-frequency>{frequency}</span>
      at <span class="param" data-trigger-time>{triggerTime}</span> (<span class="param" data-timezone>{timezone}</span>
      time).
    </li>
    <li id="hourly" class="d-none">Files will be processed <b>hourly</b></li>
    <li>The file will be in <span class="param" data-filetype>{fileType}</span> format.</li>
    <li>The file will contain a header row that lists the field names.</li>
    <li>Each data row will include the field values.</li>
  </ol>

  <h2 class="pagebreak">API Payload</h2>
  <p>The fields in the file will be mapped to the API as shown in the payload below, where API property names are
    listed on the left, and field names are displayed in curly braces on the right.</p>
  <div id="payload-container">
    <div id="payload"></div>
  </div>

</div>

<style>
  .param {
    font-weight: bold;
  }

  header {
    display: none;
  }

  #payload-container {
    padding: 20px;
    border: 0.5px solid gray;
  }

  @media print {
    .pagebreak {
      page-break-before: always;
    }
  }
</style>
<script>

  // Import file from local storage and assign to edsPayload
  const edsPayload = JSON.parse(localStorage.getItem('eds-sow'))
  if (edsPayload === null)
    window.location.href = '../../attentive/custom-attributes'
  console.log("EDS PAYLOAD:", edsPayload)

  // Function for replacing html text variables
  function replaceText(dataElement, value) {
    console.log("ELEMENT ID:", dataElement)
    console.log("VALUE:", value)
    document.querySelectorAll(`[data-${dataElement}]`).forEach(element => {
      console.log("ELEMENT:", element)
      element.textContent = value
    })
  }

  let api
  let date
  date = new Date().toLocaleDateString()

  // Date
  replaceText("date", date)

  // Client Name
  if (edsPayload.clientPayload.clientName) {
    replaceText("client-name", edsPayload.clientPayload.clientName)
  }

  // API
  const url = edsPayload.request_details.url
  api = getApiFromUrl(url)
  replaceText("api", api)

  // key_name
  const key_name = edsPayload.source_details.key_name
  console.log("KEY NAME:", key_name)

  if (key_name != null && key_name != '') {
    // filename
    const fileName = edsPayload.clientPayload.fileName.replace(/\.\w*/, '').toString()
    replaceText("filename", fileName)

    // file-name-and-date
    const fileNameAndDate = key_name.replace(/<&\S+&>/, '')
    replaceText("file-name-and-date", fileNameAndDate)

    // dateFormat
    const dateFormat = key_name.match(/\[\[\w+\]\]/)
    console.log("DATE FORMAT:", dateFormat)
    replaceText("date-format", dateFormat)
    if (dateFormat === null) document.querySelector("#date-format").classList.add('d-none')
  }

  // filetype
  let fileType = "CSV"
  if (edsPayload.clientPayload.fileType) {
    fileType = edsPayload.clientPayload.fileType
  }
  replaceText("filetype", fileType)

  // frequency
  const frequency = edsPayload.schedulePayload.frequency
  console.log("FREQUENCY:", frequency)
  if (frequency && frequency.toLowerCase() == "hourly") {
    document.querySelector("#hourly").classList.remove('d-none')
    document.querySelector("#frequency").classList.add('d-none')
  } else if (frequency && frequency != null && frequency != '') {
    replaceText("frequency", frequency)
  } else {
    document.querySelector("#frequency").classList.add('d-none')
  }

  // time
  if (edsPayload.schedulePayload.triggerTime) {
    const triggerTime = edsPayload.schedulePayload.triggerTime
    replaceText("trigger-time", triggerTime)
  }

  // timezone
  if (edsPayload.schedulePayload.timeZone) {
    const timeZone = edsPayload.schedulePayload.timeZone
    replaceText("timezone", timeZone)
  }

  // if (frequency === null) document.querySelector("#frequency").classList.add('d-none')

  // Mask API Key
  maskedPayload = edsPayload.request_details.header_mapping.Authorization.toString().replace(/Bearer (.*)/, 'Bearer ********')
  edsPayload.request_details.header_mapping.Authorization = maskedPayload

  // Render Target Payload
  aceJsonRequest = ace.edit(
    document.querySelector("#payload")
  )
  aceJsonRequest.setTheme('ace/theme/xcode')
  aceJsonRequest.session.setMode('ace/mode/json')
  aceJsonRequest.setValue(null)
  aceJsonRequest.insert(JSON.stringify(edsPayload.request_details, null, 2))
  aceJsonRequest.setReadOnly(true)
  aceJsonRequest.setOptions({
    maxLines: 60,
    highlightActiveLine: false,
    showLineNumbers: false,
    showGutter: false,
    showPrintMargin: false,
    fontSize: 14
  })

  // Change Page Title
  let pageTitle = "EDS"
  if (edsPayload.clientPayload["ticketUrl"] && edsPayload.clientPayload["ticketUrl"].length > 0 && edsPayload.clientPayload["ticketUrl"].match(/\d+$/)) {
    pageTitle += `-${edsPayload.clientPayload["ticketUrl"].match(/\d+$/).toString()}`
  }
  if (edsPayload.clientPayload["clientName"] && edsPayload.clientPayload["clientName"].length > 0) {
    pageTitle += ` - ${edsPayload.clientPayload["clientName"]}`
  }
  pageTitle += ` - ${api}`
  document.title = pageTitle

</script>