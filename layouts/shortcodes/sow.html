<div class="p-2" id="{{ .Params.id }}">

  <!-- <h3>Hugo Params</h3>
  {{ range $elem_key, $elem_val := .Params }}
  <b>{{ $elem_key }}</b>: <code>{{ $elem_val }}</code><br />
  {{ end }}
  <pre>
  .Site => {{ .Site }}
  .Site.Title => {{ .Site.Title }}
  .Page => {{ .Page }}
  .Page.Title => {{ .Page.Title }}
  .Params.id => {{ .Params.id }}
  </pre> -->


  <h2><span class="" data-client-name>{Client Name}</span>&nbsp;&ndash;&nbsp;EDS&nbsp;<span class="param" data-api>{API}
    </span>&nbsp;API
  </h2>
  <p><span class="" data-date>{Date}</span></p>

  <h2>Background</h2>
  <p>This Statement of Work defines the client's request to submit <span class="param" data-api>{API}</span> API
    requests for users via CSV upload.
  </p>

  <h2>Purpose</h2>
  <p>This Statement of Work covers the allowable scope of the project. Any term not defined herein shall have the
    meaning set forth in the Attentive Master Subscription Agreement or the relevant Order Form.</p>

  <h2>Specification</h2>
  <ol>
    <li>Client will upload files to: <span class="param" data-file-name-and-date>{fileNameAndDate}</span></li>
    <ul>
      <li><span class="param" data-filename>{filename}</span> represents the path and filename.</li>
      <li><span class="param" data-date-format>{[[dateFormat]]}</span> represents the date the file will be processed.
      </li>
    </ul>
    <li>The file will be in <span class="param" data-filetype>{fileType}</span> format</li>
    <li>The file will contain a header row that lists the field names.</li>
    <li>Each data row will include the field values.</li>
    <li>The file will be processed <span class="param" data-frequency>{frequency}</span> at <span class="param"
        data-trigger-time>{triggerTime}</span> (<span class="param" data-timezone>{timezone}</span> time)</li>
  </ol>

  <h2 class="pagebreak">API Payload</h2>
  <p>The fields in the file will be mapped to the API as shown in the payload below, where API property names are
    listed on the left, and field names are displayed in curly braces on the right.</p>
  <div id="payload-container">
    <div id="payload"></div>
  </div>

</div>

<style>
  .param {
    font-weight: bold;
    /* padding: 0.25rem; */
    /* background-color: lightyellow; */
  }

  header {
    display: none;
  }

  #payload-container {
    padding: 20px;
    border: 0.5px solid gray;
  }

  @media print {
    .pagebreak {
      page-break-before: always;
    }
  }
</style>
<script>

  // Import file from local storage and assign to edsPayload
  const edsPayload = JSON.parse(localStorage.getItem('eds-sow'))
  if (edsPayload === null)
    window.location.href = '../../attentive/custom-attributes'
  console.log("EDS PAYLOAD:", edsPayload)

  // Function for replacing html text variables
  function replaceText(dataElement, value) {
    console.log("ELEMENT ID:", dataElement)
    console.log("VALUE:", value)
    document.querySelectorAll(`[data-${dataElement}]`).forEach(element => {
      console.log("ELEMENT:", element)
      element.textContent = value
    })
  }

  let api
  let clientName = {}
  let date
  date = date = new Date().toLocaleDateString()

  // Date
  replaceText("date", date)

  // Client Name
  replaceText("client-name", edsPayload.clientPayload.clientName)

  // API
  const url = edsPayload.targetPayload.url
  console.log("url:", url)
  switch (url) {
    case 'https://api.attentivemobile.com/v1/attributes/custom':
      api = "Custom Attributes"
      break
    case "https://api.attentivemobile.com/v1/events/custom":
      api = "Custom Events"
      break
    case "https://api.attentivemobile.com/v1/events/ecommerce/add-to-cart":
      api = "eCommerce Add to Cart"
      break
    case "https://api.attentivemobile.com/v1/events/ecommerce/product-view":
      api = "eCommerce Product View"
      break
    case "https://api.attentivemobile.com/v1/events/ecommerce/purchase":
      api = "eCommerce Purchase"
      break
    case "https://api.attentivemobile.com/v1/identity-resolution/user-identifiers":
      api = "Identity"
      break
    case "https://api.attentivemobile.com/v1/text/send":
      api = "Messages"
      break
    case "https://api.attentivemobile.com/v1/privacy/delete-request":
      api = "Privacy Request"
      break
    case "https://api.attentivemobile.com/v1/subscriptions":
      api = "Subscribe"
      break
    case "https://api.attentivemobile.com/v1/subscriptions/unsubscribe":
      api = "Unsubscribe"
      break
    default:
      api = ""
  }
  replaceText("api", api)

  // key_name
  const key_name = edsPayload.sourcePayload.key_name
  // replaceText("key-name", key_name)

  // file-name-and-date
  const fileNameAndDate = key_name.replace(/<&\S+&>/, '')
  replaceText("file-name-and-date", fileNameAndDate)

  // filename
  const fileName = edsPayload.clientPayload.fileName.replace(/\.\w*/, '')
  replaceText("filename", fileName)

  // filetype
  const fileType = edsPayload.clientPayload.fileType
  replaceText("filetype", fileType)

  // dateFormat
  const dateFormat = key_name.match(/\[\[\w+\]\]/)
  replaceText("date-format", dateFormat)

  // frequency
  const frequency = "Daily"
  replaceText("frequency", frequency)

  // time
  const triggerTime = edsPayload.clientPayload.triggerTime
  replaceText("trigger-time", triggerTime)

  // timezone
  const timeZone = edsPayload.clientPayload.timeZone
  replaceText("timezone", timeZone)

  // Mask API Key
  maskedPayload = edsPayload.targetPayload.header_mapping.Authorization.toString().replace(/Bearer (.*)/, 'Bearer ********')
  edsPayload.targetPayload.header_mapping.Authorization = maskedPayload

  // Render Target Payload
  aceJsonRequest = ace.edit(
    document.querySelector("#payload")
  )
  aceJsonRequest.setTheme('ace/theme/xcode')
  aceJsonRequest.session.setMode('ace/mode/json')
  aceJsonRequest.setValue(null)
  aceJsonRequest.insert(JSON.stringify(edsPayload.targetPayload, null, 2))
  aceJsonRequest.setReadOnly(true)
  aceJsonRequest.setOptions({
    maxLines: 30,
    highlightActiveLine: false,
    showLineNumbers: false,
    showGutter: false,
    showPrintMargin: false,
    fontSize: 14
  })

</script>